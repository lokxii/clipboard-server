#!/bin/bash

base=$2
status_code=$4
file="$(find "$base"/to_upload/ -maxdepth 1 -type f -exec stat --printf '%Y %n\n' {} \; | \
    sort -nr | \
    head -1 | \
    sed -n '{s/[^ ]\+ //; p}')"
[[ -n "$file" ]] || printf 410 > "$status_code"

cat "$file"

additional_headers=$3

echo "Content-Disposition: attachment; filename=$(basename "$file")" >> "$additional_headers"
echo "Content-Type: application/octet-stream" >> "$additional_headers"

printf 200 > "$status_code"
